<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>NIST 800-63-4 Auditor — Operational README</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Operational guide and README for the NIST 800-63-4 Auditor tool." />
  <style>
    :root {
      --bg: #0b1220;
      --panel: #0f172a;
      --card: #0b1021;
      --text: #e5e7eb;
      --muted: #94a3b8;
      --primary: #38bdf8;
      --accent: #22c55e;
      --warn: #f59e0b;
      --fail: #ef4444;
      --border: #1f2a44;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
    }
    * { box-sizing: border-box; }
    html, body { margin: 0; padding: 0; background: var(--bg); color: var(--text); font-family: var(--sans); line-height: 1.6; }
    a { color: var(--primary); text-decoration: none; }
    a:hover { text-decoration: underline; }
    .container { max-width: 980px; margin: 0 auto; padding: 28px 18px 64px; }
    header { background: linear-gradient(180deg, rgba(56,189,248,0.12), rgba(34,197,94,0.06)); border: 1px solid var(--border); padding: 22px; border-radius: 14px; }
    h1 { margin: 0; font-size: 32px; letter-spacing: 0.2px; }
    .subtitle { color: var(--muted); margin-top: 6px; }
    .meta { color: var(--muted); font-size: 14px; margin-top: 6px; }
    .grid { display: grid; grid-template-columns: 1fr; gap: 16px; }
    .toc { background: var(--panel); border: 1px solid var(--border); padding: 16px; border-radius: 12px; }
    .toc h2 { margin-top: 0; font-size: 18px; }
    .toc ul { list-style: none; padding-left: 0; margin: 8px 0 0; }
    .toc li { margin: 6px 0; }
    .section { background: var(--panel); border: 1px solid var(--border); padding: 18px; border-radius: 12px; }
    h2 { font-size: 24px; margin: 8px 0 12px; }
    h3 { font-size: 18px; margin: 18px 0 8px; }
    p { margin: 10px 0; }
    ul { margin: 10px 0; padding-left: 20px; }
    code, pre { font-family: var(--mono); }
    pre { background: var(--card); border: 1px solid var(--border); padding: 12px; border-radius: 10px; overflow-x: auto; }
    .callout { border-left: 4px solid var(--primary); background: rgba(56,189,248,0.08); padding: 12px 14px; border-radius: 8px; }
    .tag { display: inline-block; padding: 2px 8px; border-radius: 999px; font-size: 12px; border: 1px solid var(--border); color: var(--muted); background: rgba(148,163,184,0.08); margin-right: 6px; }
    .kbd { display: inline-block; padding: 0px 6px; border-radius: 6px; border: 1px solid var(--border); background: var(--card); font-family: var(--mono); font-size: 12px; color: var(--muted); }
    .status { display: inline-block; padding: 2px 8px; border-radius: 999px; font-size: 12px; margin-right: 6px; }
    .status.pass { background: rgba(34,197,94,0.1); color: #22c55e; border: 1px solid rgba(34,197,94,0.35); }
    .status.warn { background: rgba(245,158,11,0.1); color: #f59e0b; border: 1px solid rgba(245,158,11,0.35); }
    .status.fail { background: rgba(239,68,68,0.1); color: #ef4444; border: 1px solid rgba(239,68,68,0.35); }
    .hr { height: 1px; background: var(--border); margin: 26px 0; }
    footer { color: var(--muted); font-size: 14px; margin-top: 20px; }
    .small { color: var(--muted); font-size: 14px; }
    .toc a { display: inline-block; padding: 2px 0; }
    .inline-tags .tag { margin-bottom: 6px; }
    @media (min-width: 900px) {
      .grid { grid-template-columns: 280px 1fr; }
      .toc { position: sticky; top: 18px; height: max-content; }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>NIST 800-63-4 Auditor — Operational README</h1>
      <div class="subtitle">A Python-based auditing tool for assessing compliance with NIST SP 800-63-4 Digital Identity Guidelines.</div>
      <div class="meta">Last updated: <span id="lastUpdated"></span></div>
    </header>

    <div class="hr"></div>

    <div class="grid">
      <nav class="toc">
        <h2>Table of Contents</h2>
        <ul id="toc">
          <!-- Auto-generated -->
        </ul>
      </nav>

      <main>
        <section class="section" id="overview">
          <h2>Overview</h2>
          <p>This tool enables consistent evaluation of identity and authentication controls against the NIST SP 800-63-4 framework. It supports both manual configuration and automated collection (via Microsoft Entra ID and system probes). The output is designed for audit evidence, gap analysis, and compliance reporting.</p>
          <div class="inline-tags">
            <span class="tag">IAL</span>
            <span class="tag">AAL</span>
            <span class="tag">FAL</span>
            <span class="tag">Entra ID</span>
            <span class="tag">Microsoft Graph</span>
            <span class="tag">TLS</span>
          </div>
        </section>

        <section class="section" id="capabilities">
          <h2>Key Capabilities</h2>
          <ul>
            <li>Automated data collection from Microsoft Entra ID via Microsoft Graph</li>
            <li>Local system checks: crypto capabilities, TLS probing, endpoint hygiene</li>
            <li>Manual configuration intake (YAML) for systems without API access</li>
            <li>Standards-aligned checks for IAL, AAL, FAL</li>
            <li>Report generation in JSON, TXT, and HTML</li>
            <li>Findings scored as <span class="status pass">PASS</span> <span class="status warn">WARN</span> <span class="status fail">FAIL</span> with rationale and remediation</li>
          </ul>
        </section>

        <section class="section" id="sources">
          <h2>Supported Data Sources</h2>
          <ul>
            <li>Manual input via prompts or YAML configuration</li>
            <li>Entra ID collector (Graph API): password/MFA/conditional access policies</li>
            <li>Auto collector: crypto/TLS/system info from the local environment</li>
            <li>HTTPS probe: TLS configuration of specified endpoints</li>
          </ul>
        </section>

        <section class="section" id="requirements">
          <h2>System Requirements</h2>
          <ul>
            <li>Python 3.9+ (3.11 recommended)</li>
            <li>OS: Linux, macOS, or Windows</li>
            <li>Internet access for Entra ID/Graph and HTTPS probes</li>
            <li>Permissions: Azure App Registration with read-only Graph scopes</li>
          </ul>
        </section>

        <section class="section" id="installation">
          <h2>Installation</h2>
          <h3>1) Clone and set up environment</h3>
          <pre><code class="language-bash">git clone &lt;your-repo-url&gt;
cd auditor
python -m venv .venv
source .venv/bin/activate   # (Windows: .venv\Scripts\activate)
pip install -r requirements.txt</code></pre>
          <p class="small">If you do not have a requirements.txt:</p>
          <pre><code class="language-bash">pip install requests msal cryptography pyopenssl pyyaml rich</code></pre>

          <h3>2) Optional: Docker</h3>
          <p class="small">Dockerfile:</p>
          <pre><code class="language-dockerfile">FROM python:3.11-slim
WORKDIR /app
COPY . /app
RUN pip install -U pip &amp;&amp; pip install -r requirements.txt
ENV PYTHONUNBUFFERED=1
CMD ["python", "auditor.py", "--help"]</code></pre>
          <p>Build and run:</p>
          <pre><code class="language-bash">docker build -t nist-auditor:latest .
docker run --rm -it nist-auditor:latest --help</code></pre>
        </section>

        <section class="section" id="configuration">
          <h2>Configuration</h2>
          <h3>Entra ID (Microsoft Graph) Setup</h3>
          <p>Create an Azure App Registration and capture the Tenant ID, Client ID, and Client Secret (store securely). Grant read-only Microsoft Graph application permissions using least privilege. Common permissions:</p>
          <ul>
            <li>Policy.Read.All</li>
            <li>Directory.Read.All</li>
            <li>AuditLog.Read.All</li>
            <li>IdentityUserFlow.Read.All</li>
            <li>AuthenticationMethodPolicy.Read.All</li>
            <li>ConditionalAccess.Read.All</li>
          </ul>
          <p>Set environment variables:</p>
          <pre><code class="language-bash">export ENTRA_TENANT_ID="xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx"
export ENTRA_CLIENT_ID="yyyyyyyy-yyyy-yyyy-yyyy-yyyyyyyyyyyy"
export ENTRA_CLIENT_SECRET="your-super-secret"</code></pre>

          <h3>Manual Config (YAML)</h3>
          <pre><code class="language-yaml">system:
  name: "Payment-Portal"
  owner: "IAM Team"
  environment: "production"

authentication:
  password_policy:
    min_length: 12
    requires_uppercase: true
    requires_lowercase: true
    requires_number: true
    requires_symbol: true
    reuse_prevention: 24
    max_age_days: 365
    lockout_threshold: 10
    lockout_duration_minutes: 15
  mfa:
    enabled: true
    allowed_factors: ["TOTP", "FIDO2", "Push"]
    required_for_admins: true
    required_for_all_users: true
  recovery:
    email_reset_allowed: false
    sms_reset_allowed: false
    kbq_allowed: false

session:
  idle_timeout_minutes: 15
  absolute_timeout_hours: 8
  reauth_for_sensitive_actions: true

transport:
  https_required: true
  hsts_enabled: true
  min_tls_version: "1.2"
  allowed_ciphersuites: ["TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384", "TLS_AES_256_GCM_SHA384"]

privacy:
  pii_minimization: true
  pii_retention_days: 365
  pii_encrypted_at_rest: true</code></pre>
        </section>

        <section class="section" id="usage">
          <h2>Running the Auditor</h2>
          <pre><code class="language-bash">python auditor.py --help</code></pre>
          <h3>Common modes</h3>
          <pre><code class="language-bash"># Manual config file
python auditor.py --input config.yaml --format json --out ./reports

# Interactive prompts (no file)
python auditor.py --interactive --format txt

# Entra ID automated collection
python auditor.py --entra --format html --out ./reports

# HTTPS probe of endpoints
python auditor.py --probe https://login.example.com --probe https://app.example.com --format json

# Combine Entra ID with HTTPS probe
python auditor.py --entra --probe https://login.microsoftonline.com --format html --out ./reports</code></pre>
          <p>Output formats:</p>
          <p class="inline-tags">
            <span class="tag">json</span>
            <span class="tag">txt</span>
            <span class="tag">html</span>
          </p>
        </section>

        <section class="section" id="results">
          <h2>Understanding Results</h2>
          <p>Each control is evaluated with a status and rationale:</p>
          <ul>
            <li><span class="status pass">PASS</span> Meets NIST SP 800-63-4 expectations</li>
            <li><span class="status warn">WARN</span> Partial or ambiguous compliance</li>
            <li><span class="status fail">FAIL</span> Not compliant</li>
          </ul>
          <p>Findings include control/category, evidence, expected criteria, gap analysis, and remediation recommendations.</p>
          <div class="callout">Ensure target AAL/IAL/FAL are set appropriately via CLI or YAML.</div>
        </section>

        <section class="section" id="security">
          <h2>Security and Privacy Guidance</h2>
          <ul>
            <li>Store secrets in a secure vault; never commit them.</li>
            <li>Use read-only Graph scopes (least privilege).</li>
            <li>Limit report distribution; may contain sensitive details.</li>
            <li>Authorize probes; avoid scanning without approval.</li>
            <li>Sanitize reports before sharing externally.</li>
          </ul>
        </section>

        <section class="section" id="troubleshooting">
          <h2>Troubleshooting</h2>
          <ul>
            <li><strong>401/403</strong>: Verify tenant/client IDs, secret, admin consent, and required scopes.</li>
            <li><strong>Missing data</strong>: Ensure appropriate read scopes (e.g., ConditionalAccess.Read.All).</li>
            <li><strong>429 (rate limiting)</strong>: Retry later; add backoff in pipelines.</li>
            <li><strong>TLS probe errors</strong>: Use proper hostname/SNI; check corporate proxies.</li>
            <li><strong>HTML report missing</strong>: Ensure your version supports HTML and dependencies are installed.</li>
          </ul>
        </section>

        <section class="section" id="best-practices">
          <h2>Operational Best Practices</h2>
          <ul>
            <li>Pin package versions in requirements.txt; update quarterly.</li>
            <li>Rotate client secrets; prefer managed identities.</li>
            <li>Log centrally with redaction.</li>
            <li>Maintain a changelog for control logic updates.</li>
            <li>Validate Graph schema periodically.</li>
          </ul>
        </section>

        <section class="section" id="examples">
          <h2>Example Commands</h2>
          <pre><code class="language-bash"># Baseline Entra ID assessment
python auditor.py --entra --format html --out ./reports

# Production web app probe with manual config
python auditor.py --input prod.yaml --probe https://app.example.com --format json --out ./reports

# Quick interactive check
python auditor.py --interactive --format txt</code></pre>
        </section>

        <section class="section" id="sample-output">
          <h2>Sample Output (JSON)</h2>
          <pre><code class="language-json">{
  "system": "Payment-Portal",
  "target_levels": {"IAL": 2, "AAL": 2, "FAL": 2},
  "findings": [
    {
      "control": "PasswordPolicy.MinLength",
      "status": "PASS",
      "observed": 12,
      "expected": ">= 8",
      "rationale": "Meets minimum NIST guidance."
    },
    {
      "control": "MFA.RequiredForAllUsers",
      "status": "FAIL",
      "observed": false,
      "expected": true,
      "remediation": "Enforce MFA for all interactive sign-ins."
    }
  ],
  "summary": { "pass": 25, "warn": 6, "fail": 3, "risk_rating": "Medium" }
}</code></pre>
        </section>

        <section class="section" id="faq">
          <h2>FAQ</h2>
          <p><strong>What Graph permissions do I need?</strong> Start with read-only scopes and add only what’s necessary (e.g., Policy.Read.All, Directory.Read.All, ConditionalAccess.Read.All, AuthenticationMethodPolicy.Read.All). Admin consent required.</p>
          <p><strong>Can I run this offline?</strong> Yes, using manual YAML config. Entra ID collection needs internet.</p>
          <p><strong>How do I target specific AAL/IAL/FAL?</strong> Use CLI flags if supported (e.g., --aal 2 --ial 2 --fal 2) or set in YAML.</p>
          <p><strong>Does this change my tenant?</strong> No. All calls are read-only.</p>
        </section>

        <section class="section" id="appendix-a">
          <h2>Appendix A — Example .env</h2>
          <pre><code class="language-bash">ENTRA_TENANT_ID=xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx
ENTRA_CLIENT_ID=yyyyyyyy-yyyy-yyyy-yyyy-yyyyyyyyyyyy
ENTRA_CLIENT_SECRET=your-secret
HTTP_PROXY=
HTTPS_PROXY=
NO_PROXY=localhost,127.0.0.1</code></pre>
          <p>Load it:</p>
          <pre><code class="language-bash">export $(grep -v '^#' .env | xargs)</code></pre>
        </section>

        <section class="section" id="appendix-b">
          <h2>Appendix B — GitHub Actions CI</h2>
          <pre><code class="language-yaml">name: NIST Auditor
on: [workflow_dispatch]
jobs:
  run-audit:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      - run: pip install -r requirements.txt
      - run: |
          python auditor.py --entra --format json --out reports
        env:
          ENTRA_TENANT_ID: ${{ secrets.ENTRA_TENANT_ID }}
          ENTRA_CLIENT_ID: ${{ secrets.ENTRA_CLIENT_ID }}
          ENTRA_CLIENT_SECRET: ${{ secrets.ENTRA_CLIENT_SECRET }}
      - uses: actions/upload-artifact@v4
        with:
          name: nist-auditor-reports
          path: reports</code></pre>
        </section>

        <section class="section" id="license">
          <h2>License</h2>
          <p>For internal organizational use. This guide does not replace formal compliance advice. Align with NIST SP 800-63-4 and your enterprise policies.</p>
        </section>

        <footer>
          <div class="hr"></div>
          <div>© <span id="year"></span> Your Organization. All rights reserved.</div>
        </footer>
      </main>
    </div>
  </div>

  <script>
    // Set dates
    document.getElementById('lastUpdated').textContent = new Date().toISOString().slice(0,10);
    document.getElementById('year').textContent = new Date().getFullYear();

    // Build TOC from h2 elements within main
    (function buildTOC() {
      const toc = document.getElementById('toc');
      const main = document.querySelector('main');
      const sections = main.querySelectorAll('section');
      const items = [];
      sections.forEach(sec => {
        const h2 = sec.querySelector('h2');
        if (!h2) return;
        const id = sec.id || h2.textContent.toLowerCase().replace(/[^a-z0-9]+/g,'-').replace(/(^-|-$)/g,'');
        sec.id = id;
        const li = document.createElement('li');
        const a = document.createElement('a');
        a.href = '#' + id;
        a.textContent = h2.textContent;
        li.appendChild(a);
        items.push(li);
      });
      items.forEach(li => toc.appendChild(li));
    })();
  </script>
</body>
</html>
